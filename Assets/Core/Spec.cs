using UnityEngine;
using System.Collections;

[RequireComponent(typeof(AudioSource))]
public class Spec : MonoBehaviour {


    public int bCo = 500000;
    public string songBeat = "";

    private string songBeatInput2 = "@63033@82790@101606@123244@143001@162758@183455@194745@205094@219206@228614@248371@268127@289766@300115@312345@324575@331161@342451@353740@364089@375379@383846@394195@414892@435590@456287@467577@477926@495801@519321@529670@540019@551308@563539@584236@593644@613401@624691@634099@645388@667027@676435@686783@697132@708422@717830@729119@748876@758284@780863@792153@801561@811910@826022@831667@837311@845779@862713@870239@882470@894700@904108@910694@926687@941740@946444@954911@967142@977491@989721@996307@1001011@1010419@1023590@1038643@1048051@1060281@1069689@1076275@1081919@1093209@1102617@1112966@1124255@1133663@1144012@1152479@1159065@1164710@1176940@1186348@1195756@1207046@1217395@1227743@1236211@1241855@1248441@1258790@1270079@1281369@1290777@1301126@1310534@1322764@1329350@1334054@1343462@1352870@1363219@1368863@1374508@1382975@1394265@1405555@1415903@1425311@1437542@1447891@1454476@1460121@1468588@1478937@1489286@1494931@1500575@1511865@1519391@1530681@1541030@1549497@1562668@1571135@1577721@1583366@1592774@1603123@1612531@1624761@1633228@1644518@1653926@1659571@1665215@1674623@1684972@1697203@1708492@1717900@1728249@1737657@1743302@1748947@1759295@1770585@1779052@1791283@1801631@1811980@1820447@1827974@1833619@1842086@1852435@1862783@1874073@1883481@1895711@1906060@1915468@1924876@1936166@1943692@1950278@1957804@1968153@1979443@1987910@1994495@2001081@2011430@2020838@2030246@2035891@2041535@2049062@2061292@2071641@2081990@2091398@2102687@2112095@2118681@2126207@2133734@2144083@2155372@2161017@2166662@2177011@2186419@2196767@2215583@2227814@2248511@2257919@2270150@2290847@2311545@2318131@2324716@2331302@2341651@2353881@2362348@2374579@2384927@2395276@2415974@2436671@2457369@2466777@2478067@2498764@2518521@2528870@2539219@2545804@2559916@2572147@2581555@2591903@2603193@2613542@2624831@2635180@2645529@2653996@2659641@2666227@2676575@2685983@2696332@2707622@2717971@2728319@2747135@2756543@2768774@2788531@2812051@2828985@2841215@2852505@2873203@2893900@2909894@2923065@2935295@2956934@2977631@3000211@3023731@3063244@3078297@3090527@3102758@3128159@3146035@3159206@3173318@3184607@3207187@3226943@3241055@3256108@3269279@3393465@3413222@3434860@3456499@3478137@3498835@3519532@3539289@3561868@3581625@3602323@3622079@3643718@3664415@3686054@3706751@3728390@3749087@3769785@3789542@3810239@3830937@3851635@3871391@3893030@3914668@3935366@3956063@3978643@3997459@4019097@4040735@4059551@4079308@4092479@4103769@4123526@4145164@4159276@4174329@4186559@4195967@4208198@4227955@4243007@4259001@4268409@4288166@4310745@4331443@4352140@4372838@4394476@4408588@4423641@4435871@4456569@4478207@4493260@4508313@4519603@4529011@4539359@4560998@4576051@4592044@4602393@4613683@4624031@4643788@4663545@4686124@4695532@4707763@4729401@4749158@4769855@4790553@4811251@4829126@4841356@4852646@4873343@4892159@4908153@4923206@4935436@4956134@4975891@4993766@5007878@5019167@5029516@5039865@5061503@5076556@5089727@5101958@5123596@5145235@5160287@5174399@5185689@5207327@5228025@5244019@5259071@5270361@5279769@5291999@5312697@5325868@5342803@5354092@5364441@5372908@5394547@5415244@5423711@5435942@5447231@5466988@5478278@5493331@5507443@5529081@5540371@5550719@5561068@5571417@5577062@5583647@5588351@5602463@5613753@5623161@5633510@5644799@5659852@5673023@5681491@5695603@5707833@5717241@5728531@5740761@5747347@5752051@5757695@5778393@5791564@5800972@5811321@5828255@5839545@5854598@5865887@5875295@5884703@5894111@5911046@5916691@5922335@5928921@5947737@5959967@5968435@5978783@5993836@6006067@6011711@6028646@6033350@6043699@6051225@6062515@6074745@6081331@6086975@6093561@6104851@6114259@6125548@6134956@6144364@6158476@6163180@6170707@6176351@6193286@6199871@6208339@6217747@6227155@6239385@6245030@6249734@6256319@6272313@6281721@6292070@6299596@6310886@6323116@6329702@6337228@6344755@6355103@6365452@6374860@6384268@6394617@6404966@6410611@6417196@6423782@6436953@6448243@6459532@6468940@6478348@6489638@6495283@6501868@6507513@6517862@6530092@6541382@6550790@6560198@6569606@6576191@6581836@6587481@6602534@6614764@6623231@6632639@6643929@6658041@6663686@6670271@6685324@6696614@6708844@6716371@6727660@6747417@6756825@6769055@6789753@6811391@6827385@6841497@6853727@6873484@6894182@6908294@6922406@6936518@6955334@6976972@6992966@7008019@7018367@7027775@7039065@7060703@7077638@7088927@7101158@7121855@7143494@7160428@7173599@7185830@7194297@7205587@7227225@7244159@7256390@7268620@7289318@7312838@7327891@7341062@7353292@7373049@7394687@7413503@7423852@7437964@7456780@7478419@7495353@7509465@7518873@7531103@7541452@7562150@7576262@7589433@7602604@7612953@7623302@7644940@7659993@7674105@7685395@7694803@7706092@7725849@7740902@7746547@7757836@7770067@7788883@7810521@7825574@7838745@7851916@7859443@7871673@7882022@7894252@7908364@7915891@7923417@7935647@7945996@7956345@7966694@7977043@7994918@8018438@8040076@8062655@8080531@8092761@8102169@8113459@8123807@8132275@8144505@8158617@8165203@8170847@8176492@8186841@8197190@8208479@8218828@8228236@8238585@8244230@8250815@8255519@8268691@8279980@8290329@8300678@8310086@8324198@8328902@8336428@8341132@8351481@8362771@8374060@8383468@8393817@8403225@8409811@8416396@8421100@8437094@8448383@8460614@8469081@8479430@8492601@8499187@8506713@8512358@8527411@8534937@8542463@8550931@8561279@8570687@8575391@8582918@8588563@8603615@8614905@8626195@8633721@8645011@8659123@8664767@8674175@8679820@8693932@8706163@8716511@8727801@8741913@8746617@8753203@8760729@8779545@8791775@8801183@8811532@8824703@8831289@8837875@8843519@8862335@8874566@8883974@8894323@8907494@8913139@8920665@8926310@8946067@8958297@8967705@8976172@8992166@8997811@9003455@9010041@9020390@9029798@9039206@9050495@9061785@9074015@9079660@9085305@9090950@9103180@9114470@9125759@9134227@9145516@9157747@9164332@9170918@9176563@9188793@9197260@9208550@9217958@9229247@9240537@9246182@9251827@9258412@9270643@9280991@9290399@9310156@9326150@9331795@9338380@9343084@9355315@9364723@9373190@9378835@9384479@9395769@9407059@9412703";
    private string songBeatInput = "@59270@82790@103487@125126@145823@165580@186278@207916@228614@249311@269068@289766@311404@332102@353740@373497@383846@395135@415833@436531@456287@476044@498623@519321@540019@560716@582355@603052@623750@644447@665145@686783@706540@717830@727238@749817@770515@791212@811910@832607@854246@874943@894700@914457@937036@956793@976550@998188@1018886@1039583@1049932@1061222@1081919@1102617@1123315@1134604@1145894@1163769@1184467@1206105@1217395@1227743@1247500@1269139@1289836@1311475@1331231@1353811@1371686@1394265@1414963@1436601@1457299@1477996@1498694@1520332@1541030@1563609@1583366@1604063@1621939@1633228@1644518@1663334@1686854@1707551@1727308@1738598@1748006@1769644@1780934@1790342@1811980@1833619@1853375@1862783@1874073@1894771@1917350@1936166@1957804@1979443@1999199@2018956@2029305@2040595@2061292@2081990@2103628@2123385@2143142@2167603@2186419@2205235@2226873@2248511@2269209@2289907@2309663@2331302@2351999@2362348@2374579@2394335@2414092@2436671@2456428@2477126@2497823@2518521@2529811@2541100@2551449@2561798@2580614@2612601@2624831@2634239@2645529@2664345@2685043@2707622@2726438@2742431@2755603@2768774@2811110@2828985@2841215@2852505@2873203@2894841@2912716@2924947@2936236@3056659@3075475@3090527@3103699@3143212@3159206@3173318@3185548@3207187@3227884@3241055@3257049@3269279@3392524@3415103@3436742@3456499@3476255@3497894@3518591@3539289@3559987@3579743@3601382@3622079@3641836@3662534@3684172@3706751@3728390@3748147@3770726@3790483@3810239@3830937@3850694@3872332@3892089@3912787@3933484@3954182@3973939@3995577@4016275@4038854@4059551@4074604@4088716@4101887@4122585@4143283@4161158@4174329@4185619@4206316@4227014@4242067@4256179@4270291@4289107@4308863@4326739@4350259@4372838@4392595@4413292@4434931@4454687@4475385@4492319@4506431@4519603@4540300@4560057@4575110@4589222@4601452@4622150@4642847@4664486@4684243@4695532@4705881@4727519@4743513@4755743@4769855@4789612@4809369@4827244@4841356@4851705@4872403";
    //private string songBeatInput = "@38572@54566@78086@100665@117599@138297@161817@179692@204153@221087@242726@263423@284121@306700@325516@346214@368793@386668@407366@428063@449702@469459@489215@510854@531551@552249@572947@593644@613401@632217@654796@675494@699014@717830@735705@756403@778041@796857@817555@840134@865535@881529@894700@905990@926687@947385@963379@975609@986899@1006655@1030175@1044287@1059340@1072511@1090387@1112025@1128019@1143071@1153420@1173177@1194815@1211750@1235270@1255967@1275724@1292659@1306771@1316179@1339699@1360396@1378271@1391443@1400851@1421548@1442246@1460121@1483641@1504339@1525036@1541030@1554201@1565491@1587129@1608767@1624761@1648281@1667097@1689676@1706611@1718841@1730131@1751769@1772467@1788460@1813862@1835500@1854316@1872191@1887244@1896652@1917350@1938047@1954982@1979443@1999199@2012371@2023660@2038713@2052825@2065055@2082931@2096102@2104569@2118681@2133734@2145964@2166662@2186419@2202412@2215583@2228755@2247571@2258860@2270150@2286143@2298374@2310604@2329420@2351999@2366111@2380223@2394335@2413151@2432908@2445139@2464895@2476185";
    private string[] sps;

    private int il = 0;
    public int s;
    public int cSample;
    // Use this for initialization
    void Start () {
        //GetComponent<RectTransform>().anchoredPosition = new Vector2(65.0f, 800.0f);
        sps = songBeatInput.Split('@');
        il = 1;
    }

    void Update()
    {
        if (Input.GetKeyDown(KeyCode.Keypad0))
        {
            songBeat += "@" + GetComponent<AudioSource>().timeSamples;
        }

        cSample = GetComponent<AudioSource>().timeSamples;
        for (var i = 1; i < sps.Length; i++)
        {
            s = int.Parse(sps[i]);
            if (s > cSample && s - cSample < bCo)
            {
                CreateSprite(int.Parse(sps[i]), cSample);
                sps[i] = "0";
                //il = i + 1;
            }
        }

        //songBeat
        //Debug.Log((GetComponent<AudioSource>().time));
        //GetComponent<RectTransform>().anchoredPosition = Vector2.Lerp(GetComponent<RectTransform>().anchoredPosition, new Vector2(0, 200), Time.deltaTime * 0.5f);
    }

    void CreateSprite(int sD, int sC)
    {
        GameObject sprite = Instantiate(Resources.Load("Sprite")) as GameObject;
        sprite.transform.SetParent(GameObject.Find("Canvaska").transform);
        sprite.transform.localScale = new Vector3(1.0f, 1.0f, 1.0f);
        sprite.GetComponent<Beat>().sampleDestination = sD;
        sprite.GetComponent<Beat>().sampleCreated = sC;

        float w0 = (float)Screen.width * 0.5f + 100.0f;
        float w1 = (float)Screen.width + 100.0f;
        float x = Random.Range(w0, w1);
        if (Random.Range(0, 10) > 5) x *= -1.0f;


        float h0 = (float)Screen.height * 0.7f + 100.0f;
        float h1 = (float)Screen.height + 100.0f;
        float y = Random.Range(h0, h1);
        if (Random.Range(0, 10) > 5) y *= -1.0f;

        //float h0 = 350.0f;
        //float h1 = (float)Screen.height * 0.7f;
        //float y = Random.Range(h0, h1);

        sprite.GetComponent<RectTransform>().anchoredPosition = new Vector2(x, y);
    }
}
